<?php/** * Created by IntelliJ IDEA. * User: Arihant * Date: 05-05-2018 * Time: 14:31 */require 'connection.php';require 'select_last_id.php';$recevied = json_decode(file_get_contents("php://input"));$response = array();$firmid = get_last_id('firm_det') + 1;$sql = "START TRANSACTION;";$result = $conn->query($sql);$sql = "INSERT INTO `firm_det` "    . "(`id`, `xname`, `gst_no`, "    . "`pan_no`,`add1`, `city`,`state`,`pincode`)"    . " VALUES ('" . $firmid . "', '" . $recevied->xname . "', '" . $recevied->gst_no . "', "    . "'" . $recevied->pan_no . "','" . $recevied->add . "','" . $recevied->city . "','" . $recevied->state . "','" . $recevied->pincode . "');";//echo $sql;$result = $conn->query($sql);if ($result) {    if (isset($recevied->cust_name)) {        $count = sizeof($recevied->cust_name);        $i = 0;        $response['error'] = 0;//    echo $recevied->cust_name[$i]->name;        while ($i < $count) {            $owner_id = get_last_id("firm_onwer_list") + 1;            $name = $recevied->cust_name[$i]->name;            $sql = "INSERT INTO firm_onwer_list (`id`,`firm_id`,`xname`) "                . "VALUE ('" . $owner_id . "','" . $firmid . "','" . $name . "')";            $result = $conn->query($sql);            if (!$result) {                $response['error'] = 1;                $sql = "Rollback";                $result = $conn->query($sql);                $response['error_is'] = "cust error";                echo json_encode($response);                break;            } else {                $response['error'] = 0;            }            $i++;        }        if ($response['error'] == 0) {//            $sql = "COMMIT";//            $result = $conn->query($sql);//            if ($result){//                $response['success'] = 1;//                echo json_encode($response);//            }            if (isset($recevied->mob_no)) {                $count_mob = sizeof($recevied->mob_no);                $i = 0;                while ($i < $count_mob) {                    $mob_id = get_last_id("firm_mobile_no") + 1;                    $mob = $recevied->mob_no[$i]->name;                    $sql = "INSERT INTO firm_mobile_no (`id`,`firm_id`,`mob_no`) "                        . "VALUE ('" . $mob_id . "','" . $firmid . "','" . $mob . "')";                    $result = $conn->query($sql);//                    echo $sql;                    if (!$result) {                        $response['error'] = 1;                        $sql = "Rollback";                        $result = $conn->query($sql);                        $response['error_is'] = "mob error";                        echo json_encode($response);                        break;                    } else {                        $response['error'] = 0;                    }                    $i++;                }            }            if ($response['error'] == 0) {                $count_mail = sizeof($recevied->email_id);                $i = 0;                while ($i < $count_mail) {                    $mail_id = get_last_id("firm_email_id") + 1;                    $mail = $recevied->email_id[$i]->name;                    $sql = "INSERT INTO firm_email_id (`id`,`firm_id`,`email_id`) "                        . "VALUE ('" . $mail_id . "','" . $firmid . "','" . $mail . "')";                    $result = $conn->query($sql);                    if (!$result) {                        $response['error'] = 1;                        $sql = "Rollback";                        $result = $conn->query($sql);                        $response['error_is'] = "email error";                        echo json_encode($response);                        break;                    } else {                        $response['error'] = 0;                    }                    $i++;                }                if ($response['error'] == 0) {                    $sql = "COMMIT";                    $result = $conn->query($sql);                    if ($result) {                        $response['success'] = 1;                        echo json_encode($response);                    }                }            }        }    }} else {    $sql = "Rollback";    $result = $conn->query($sql);    $response['error'] = 1;    $response['error_is'] = "mst error";    echo json_encode($response);}?>