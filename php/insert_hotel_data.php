<?php/** * Created by IntelliJ IDEA. * User: Arihant * Date: 04-05-2018 * Time: 16:20 */require 'connection.php';require 'select_last_id.php';$sql = "START TRANSACTION";$result = $conn->query($sql);$recived = json_decode(file_get_contents("php://input"));$response = array('hotel' => array(),'error' => 0,'error_msg' => "");$id = get_last_id('hotel_mst') + 1;$sql = "INSERT INTO `hotel_mst` (`id`, `xname`, `chk_in_time`,"    . " `chk_out_time`, `city_name`,"    . " `add1`, `add2`,`state`,`pincode`) "    . "VALUES ('" . $id . "', '" . $recived->xname . "', '" . $recived->chk_in_time . "',"    . " '" . $recived->chk_out_time . "', '" . $recived->city->xname . "',"    . " '" . $recived->add1 . "', '" . $recived->add2 . "', '" . $recived->city->state . "','".$recived->pincode."');";//echo $sql;$result = $conn->query($sql);if ($result) {// INSERT INTO THE HOTEL CONTACT DETAILS    echo "inserting";    if (sizeof($recived->contact) > 0 and $response['error'] == 0) {//        echo "inserting con";        $count_con = sizeof($recived->contact);        $i = 0;        while ($i < $count_con) {            $con_id = get_last_id("hotel_contact") +1;            $sql = "INSERT INTO `hotel_contact`" .                " (`id`,`hotel_id`,`xname`, ".                "`phn_no`,`email_id`, `remarks`)" .                " VALUE ('".$con_id."','".$id."','".$recived->contact[$i]->name."',".                "'".$recived->contact[$i]->phn_no."','".$recived->contact[$i]->email."','".$recived->contact[$i]->remarks."')";            echo $sql;            $result = $conn->query($sql);            $i++;            if(!$result){                $sql = "ROLLBACK";                $result = $conn->query($sql);                $response['error'] = 1;                break;            }        }    }//    INSERTING THE VALUE OF HOTEL PHN NO    if (sizeof($recived->phn_no) > 0 and $response['error'] == 0){        echo "inserting phn";        $count_phn = sizeof($recived->phn_no);        $i=0;        while ($i < $count_phn){            $phn_id = get_last_id("hotel_phn_no") +1;            $sql = "INSERT INTO `hotel_phn_no`" .                " (`id`,`hotel_id`,`phn_no`)".                " VALUE ('".$phn_id."','".$id."','".$recived->phn_no[$i]->num."')";            echo $sql;            $result = $conn->query($sql);            $i++;            if(!$result){                $sql = "ROLLBACK";                $result = $conn->query($sql);                $response['error'] = 1;                break;            }        }    }//    INSERTING INTO THE EMAIL ADDRESS OF THE HOTEL    if (sizeof($recived->mail) > 0 and $response['error'] == 0){        $count_mail = sizeof($recived->mail);        $i =0;        while ($i < $count_phn){            $mail_id = get_last_id("hotel_email_id") +1;            $sql = "INSERT INTO `hotel_email_id`" .                " (`id`,`hotel_id`,`email_id`)".                " VALUE ('".$mail_id."','".$id."','".$recived->mail[$i]->mail."')";//            echo $sql;            $result = $conn->query($sql);            $i++;            if(!$result){                $sql = "ROLLBACK";                $result = $conn->query($sql);                $response['error'] = 1;                break;            }        }    }    if ($response['error'] == 0){        $result = $conn->query("COMMIT");        if ($result){            $response['action'] = 1;            echo json_encode($response);        }    }} else {    $sql = "ROLLBACK";    $result = $conn->query($sql);    $response['error'] = 1;    echo $response;}?>